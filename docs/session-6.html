<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Session 6: Multinomial model – Statistical Methods for Transport Planning - Workbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./session-7.html" rel="next">
<link href="./session-5.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-c1966a8c70583a3816b1e3a216c1caf1.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./session-6.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Session 6: Multinomial model</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistical Methods for Transport Planning - Workbook</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Session 1. Working environment and formatting data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Session 2 Data structures and descriptive statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Session 3: Linear regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Session 4: Logistic regression Part 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Session 5: Logistic regression Part 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session-6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Session 6: Multinomial model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./session-7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Session 7: Poisson regression</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">6.1</span> Introduction</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries"><span class="header-section-number">6.2</span> Preliminaries</a></li>
  <li><a href="#dependent-variable-main-mode-choice-to-work-per-person" id="toc-dependent-variable-main-mode-choice-to-work-per-person" class="nav-link" data-scroll-target="#dependent-variable-main-mode-choice-to-work-per-person"><span class="header-section-number">6.3</span> Dependent variable: Main mode choice to work per person</a></li>
  <li><a href="#independent-variables" id="toc-independent-variables" class="nav-link" data-scroll-target="#independent-variables"><span class="header-section-number">6.4</span> Independent variables</a></li>
  <li><a href="#descriptive-statistics" id="toc-descriptive-statistics" class="nav-link" data-scroll-target="#descriptive-statistics"><span class="header-section-number">6.5</span> Descriptive statistics</a></li>
  <li><a href="#multinomial-model-estimation" id="toc-multinomial-model-estimation" class="nav-link" data-scroll-target="#multinomial-model-estimation"><span class="header-section-number">6.6</span> Multinomial model estimation</a>
  <ul class="collapse">
  <li><a href="#exponentied-coefficients-odds-ratio" id="toc-exponentied-coefficients-odds-ratio" class="nav-link" data-scroll-target="#exponentied-coefficients-odds-ratio"><span class="header-section-number">6.6.1</span> Exponentied coefficients: Odds ratio</a></li>
  </ul></li>
  <li><a href="#model-assessment" id="toc-model-assessment" class="nav-link" data-scroll-target="#model-assessment"><span class="header-section-number">6.7</span> Model assessment</a>
  <ul class="collapse">
  <li><a href="#goodness-of-fit" id="toc-goodness-of-fit" class="nav-link" data-scroll-target="#goodness-of-fit"><span class="header-section-number">6.7.1</span> Goodness-of-fit</a></li>
  </ul></li>
  <li><a href="#individual-activities" id="toc-individual-activities" class="nav-link" data-scroll-target="#individual-activities"><span class="header-section-number">6.8</span> Individual activities</a></li>
  <li><a href="#bonus-multinomial-model-assumption-checks" id="toc-bonus-multinomial-model-assumption-checks" class="nav-link" data-scroll-target="#bonus-multinomial-model-assumption-checks"><span class="header-section-number">6.9</span> Bonus: Multinomial model assumption checks</a></li>
  <li><a href="#references-and-further-reading" id="toc-references-and-further-reading" class="nav-link" data-scroll-target="#references-and-further-reading"><span class="header-section-number">6.10</span> References and further reading</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Session 6: Multinomial model</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">6.1</span> Introduction</h2>
<p>Multinomial regression is useful when the dependent variable is categorical and has more than two categories. This week, we’ll build on the logistic regression example from last week, where we explored mode choice for work trips and how free parking influences that decision. This time, we’ll break down mode choice at the person level, with three possible outcomes: driving, active travel, or transit.</p>
<p>We will continue to work with the <a href="https://www.psrc.org/our-work/household-travel-survey-program">Puget Sound Household Travel Survey</a>.</p>
</section>
<section id="preliminaries" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">6.2</span> Preliminaries</h2>
<p>For today’s session we will need the following packages. Make sure that you have these packages installed in your machine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Packages </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># For data manipulation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary) <span class="co"># Descriptive statistics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet) <span class="co"># For multinomial regression</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) <span class="co"># To check the accuracy of the model</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance) <span class="co"># For model fit measures</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, we read the data in to the R session. Again, we will obtain information from trips, persons, and households tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>trips <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Trips.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>persons <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Persons.csv'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>households <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'data/Households.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We limit the data for the year 2023 only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for the year 2023 only</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>households <span class="ot">&lt;-</span> households <span class="sc">%&gt;%</span> <span class="fu">filter</span>(survey_year <span class="sc">==</span> <span class="dv">2023</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>trips <span class="ot">&lt;-</span> trips <span class="sc">%&gt;%</span> <span class="fu">filter</span>(survey_year <span class="sc">==</span> <span class="dv">2023</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>persons <span class="ot">&lt;-</span> persons <span class="sc">%&gt;%</span> <span class="fu">filter</span>(survey_year <span class="sc">==</span> <span class="dv">2023</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dependent-variable-main-mode-choice-to-work-per-person" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="dependent-variable-main-mode-choice-to-work-per-person"><span class="header-section-number">6.3</span> Dependent variable: Main mode choice to work per person</h2>
<p>In this example, we focus on trips to work only. So, we keep trips which its destination is ‘Work’ only.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>trips_work <span class="ot">&lt;-</span> trips <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">'Work'</span> <span class="sc">==</span> dest_purpose_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that in the outcomes in a multinomial model must be mutually exclusive, which means that each individual can only belong to one outcome category at a time. In this example, we identify only one ‘main’ mode of transport for each person when travelling to work.</p>
<p>Here, the main mode is defined as the one used most frequently. If a person reported using more than one mode the same number of times, we’ll select the one that covered the greatest distance. To start, we’ll summarise the frequency and distance reported for each person and each mode.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mode_summary <span class="ot">&lt;-</span> trips_work <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person_id, mode_class) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode_frequency =</span> <span class="fu">n</span>(),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode_distance =</span> <span class="fu">sum</span>(distance_miles, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And, we have a quick look to the result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mode_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,137 × 4
# Groups:   person_id [1,821]
    person_id mode_class mode_frequency mode_distance
        &lt;dbl&gt; &lt;chr&gt;               &lt;int&gt;         &lt;dbl&gt;
 1 2300017304 Drive SOV               4         16.2 
 2 2300021301 Bike                    1          1.36
 3 2300074501 Transit                 5         25.1 
 4 2300082802 Transit                 1          2.07
 5 2300116701 Drive SOV               1         25.2 
 6 2300124701 Drive SOV               1          3.90
 7 2300124702 Bike                    1          2.35
 8 2300124702 Drive SOV               2          5.15
 9 2300132201 Drive SOV               3         11.2 
10 2300149601 Transit                 1          9.64
# ℹ 2,127 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Reflection">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reflection
</div>
</div>
<div class="callout-body-container callout-body">
<p>Looking at the variables available and the summary that you just have created. Think how you can identify the ‘main’ mode before coding it.</p>
</div>
</div>
<p>Now, implement the code which select the most frequently used mode for each person in the data. If there’s a tie, we’ll choose the mode that covered the most miles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define only one 'main' mode per person based on frequency and distance</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>mode_main <span class="ot">&lt;-</span> mode_summary <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person_id) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep the most frequent modes per individual</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> mode_frequency, <span class="at">with_ties =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If tied, pick the one with more miles</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> mode_distance, <span class="at">with_ties =</span> <span class="cn">FALSE</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For simplicity in our model, we will group mode into three broader classes, namely: Drive, Transit, and Active. For this exercise, we drop all other classes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reclassify</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>mode_main <span class="ot">&lt;-</span> mode_main <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode_main =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">'Drive'</span>, mode_class) <span class="sc">~</span> <span class="st">'Drive'</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">'Transit'</span>, mode_class) <span class="sc">~</span> <span class="st">'Transit'</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(<span class="st">'Bike|Walk'</span>, mode_class) <span class="sc">~</span> <span class="st">'Active'</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># All other classes are ignored using NA</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only relevant column, i.e. main mode per individual</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>mode_main <span class="ot">&lt;-</span> mode_main <span class="sc">%&gt;%</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(person_id, mode_main)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How is the distribution of the main mode looking?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(mode_main, mode_main)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  mode_main     n
  &lt;chr&gt;     &lt;int&gt;
1 Active      336
2 Drive      1190
3 Transit     258
4 &lt;NA&gt;         37</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Reflection">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reflection
</div>
</div>
<div class="callout-body-container callout-body">
<p>Would it be possible to aggregate modal choice at a different unit of observation? Are there implications?</p>
</div>
</div>
</section>
<section id="independent-variables" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="independent-variables"><span class="header-section-number">6.4</span> Independent variables</h2>
<p>In addition to the dependent variable (mode choice in three categories), we need to define the independent variables that we think are related to mode choice to work. For this, we include information from trips, individual, and households.</p>
<p>We summarise trip information to work at the person level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>trips_distance <span class="ot">&lt;-</span> trips_work <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person_id) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_miles =</span> <span class="fu">sum</span>(distance_miles, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_days_trips =</span> <span class="fu">max</span>(daynum),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_distance =</span> total_miles <span class="sc">/</span> num_days_trips</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(num_days_trips <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> avg_distance <span class="sc">&lt;</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Later, we supplement the dependent variable information with trips, persons, and households.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the tables together</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>persons_main <span class="ot">&lt;-</span> mode_main <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(trips_distance, <span class="at">by =</span> <span class="st">'person_id'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(persons, <span class="at">by =</span> <span class="st">'person_id'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(households, <span class="at">by =</span> <span class="st">'household_id'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Reflection">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reflection
</div>
</div>
<div class="callout-body-container callout-body">
<p>Have a look to the number of observations in <code>persons_main</code> compared to <code>persons</code>. Why do we see this difference?</p>
</div>
</div>
<p>As in our prior lab, we format and label the variables that we will use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write the name and appropriate order of the levels for hhincome_broad</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>income_labs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Under $25,000"</span>, </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"$25,000-$49,999"</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"$50,000-$74,999"</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"$75,000-$99,999"</span>, </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"$100,000-$199,999"</span>, </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"$200,000 or more"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Categories for higher education (explicit definition)</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>he_levs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Bachelor degree"</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Graduate/post-graduate degree"</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Associates degree"</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Format and create appropriate variables</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>persons_main <span class="ot">&lt;-</span> persons_main <span class="sc">%&gt;%</span> </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Whether person has free parking at work</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">free_parking =</span> <span class="fu">ifelse</span>(commute_subsidy_3 <span class="sc">==</span> <span class="st">'Selected'</span>, <span class="st">'Yes'</span>, <span class="st">'No'</span>),</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simplify education, e.g. graduate and bachelor vs all other</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">higher_education =</span> <span class="fu">ifelse</span>(education <span class="sc">%in%</span> he_levs, <span class="st">'Yes'</span>, <span class="st">'No'</span>),</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">children =</span> <span class="fu">ifelse</span>(numchildren <span class="sc">==</span> <span class="st">'0 children'</span>, <span class="st">'No'</span>, <span class="st">'Yes'</span>),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">hhincome_broad =</span> <span class="fu">factor</span>(hhincome_broad, <span class="at">levels =</span> income_labs)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And, keep only the variables of interest for now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, select variables of interest</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>persons_main <span class="ot">&lt;-</span> persons_main <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    mode_main, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    free_parking,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    avg_distance,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    gender,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    higher_education,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    children,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    hhincome_broad</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># We also remove incomplete observations</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>persons_main <span class="ot">&lt;-</span> persons_main <span class="sc">%&gt;%</span> </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="descriptive-statistics" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="descriptive-statistics"><span class="header-section-number">6.5</span> Descriptive statistics</h2>
<p>Before moving into the modelling stage, we check the main descriptive statistics.</p>
<p>We split the data according to the main dependent variable, whether respondents used active mode to travel to work.</p>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>persons_main <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_summary</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> mode_main,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">all_continuous</span>() <span class="sc">~</span> <span class="st">"{mean} ± {sd}"</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_overall</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fritwmkrgh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fritwmkrgh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fritwmkrgh thead, #fritwmkrgh tbody, #fritwmkrgh tfoot, #fritwmkrgh tr, #fritwmkrgh td, #fritwmkrgh th {
  border-style: none;
}

#fritwmkrgh p {
  margin: 0;
  padding: 0;
}

#fritwmkrgh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fritwmkrgh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fritwmkrgh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fritwmkrgh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fritwmkrgh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fritwmkrgh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fritwmkrgh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fritwmkrgh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fritwmkrgh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fritwmkrgh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fritwmkrgh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fritwmkrgh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fritwmkrgh .gt_spanner_row {
  border-bottom-style: hidden;
}

#fritwmkrgh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fritwmkrgh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fritwmkrgh .gt_from_md > :first-child {
  margin-top: 0;
}

#fritwmkrgh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fritwmkrgh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fritwmkrgh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fritwmkrgh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fritwmkrgh .gt_row_group_first td {
  border-top-width: 2px;
}

#fritwmkrgh .gt_row_group_first th {
  border-top-width: 2px;
}

#fritwmkrgh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fritwmkrgh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fritwmkrgh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fritwmkrgh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fritwmkrgh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fritwmkrgh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fritwmkrgh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fritwmkrgh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fritwmkrgh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fritwmkrgh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fritwmkrgh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fritwmkrgh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fritwmkrgh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fritwmkrgh .gt_left {
  text-align: left;
}

#fritwmkrgh .gt_center {
  text-align: center;
}

#fritwmkrgh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fritwmkrgh .gt_font_normal {
  font-weight: normal;
}

#fritwmkrgh .gt_font_bold {
  font-weight: bold;
}

#fritwmkrgh .gt_font_italic {
  font-style: italic;
}

#fritwmkrgh .gt_super {
  font-size: 65%;
}

#fritwmkrgh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fritwmkrgh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fritwmkrgh .gt_indent_1 {
  text-indent: 5px;
}

#fritwmkrgh .gt_indent_2 {
  text-indent: 10px;
}

#fritwmkrgh .gt_indent_3 {
  text-indent: 15px;
}

#fritwmkrgh .gt_indent_4 {
  text-indent: 20px;
}

#fritwmkrgh .gt_indent_5 {
  text-indent: 25px;
}

#fritwmkrgh .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fritwmkrgh div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="stat_0" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Overall</strong><br> N = 1,657<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_1" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Active</strong><br> N = 318<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_2" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Drive</strong><br> N = 1,098<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
<th id="stat_3" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>Transit</strong><br> N = 241<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="label">free_parking</td>
<td class="gt_row gt_center" headers="stat_0">557 (34%)</td>
<td class="gt_row gt_center" headers="stat_1">53 (17%)</td>
<td class="gt_row gt_center" headers="stat_2">471 (43%)</td>
<td class="gt_row gt_center" headers="stat_3">33 (14%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">avg_distance</td>
<td class="gt_row gt_center" headers="stat_0">8 ± 8</td>
<td class="gt_row gt_center" headers="stat_1">2 ± 3</td>
<td class="gt_row gt_center" headers="stat_2">9 ± 9</td>
<td class="gt_row gt_center" headers="stat_3">6 ± 6</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">gender</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Boy/Man (cisgender or transgender)</td>
<td class="gt_row gt_center" headers="stat_0">774 (47%)</td>
<td class="gt_row gt_center" headers="stat_1">164 (52%)</td>
<td class="gt_row gt_center" headers="stat_2">493 (45%)</td>
<td class="gt_row gt_center" headers="stat_3">117 (49%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Girl/Woman (cisgender or transgender)</td>
<td class="gt_row gt_center" headers="stat_0">761 (46%)</td>
<td class="gt_row gt_center" headers="stat_1">129 (41%)</td>
<td class="gt_row gt_center" headers="stat_2">529 (48%)</td>
<td class="gt_row gt_center" headers="stat_3">103 (43%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Non-binary/Something else fits better</td>
<td class="gt_row gt_center" headers="stat_0">43 (2.6%)</td>
<td class="gt_row gt_center" headers="stat_1">12 (3.8%)</td>
<td class="gt_row gt_center" headers="stat_2">21 (1.9%)</td>
<td class="gt_row gt_center" headers="stat_3">10 (4.1%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Prefer not to answer</td>
<td class="gt_row gt_center" headers="stat_0">79 (4.8%)</td>
<td class="gt_row gt_center" headers="stat_1">13 (4.1%)</td>
<td class="gt_row gt_center" headers="stat_2">55 (5.0%)</td>
<td class="gt_row gt_center" headers="stat_3">11 (4.6%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">higher_education</td>
<td class="gt_row gt_center" headers="stat_0">1,307 (79%)</td>
<td class="gt_row gt_center" headers="stat_1">274 (86%)</td>
<td class="gt_row gt_center" headers="stat_2">842 (77%)</td>
<td class="gt_row gt_center" headers="stat_3">191 (79%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">children</td>
<td class="gt_row gt_center" headers="stat_0">383 (23%)</td>
<td class="gt_row gt_center" headers="stat_1">35 (11%)</td>
<td class="gt_row gt_center" headers="stat_2">317 (29%)</td>
<td class="gt_row gt_center" headers="stat_3">31 (13%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">hhincome_broad</td>
<td class="gt_row gt_center" headers="stat_0"><br>
</td>
<td class="gt_row gt_center" headers="stat_1"><br>
</td>
<td class="gt_row gt_center" headers="stat_2"><br>
</td>
<td class="gt_row gt_center" headers="stat_3"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;Under $25,000</td>
<td class="gt_row gt_center" headers="stat_0">54 (3.3%)</td>
<td class="gt_row gt_center" headers="stat_1">19 (6.0%)</td>
<td class="gt_row gt_center" headers="stat_2">18 (1.6%)</td>
<td class="gt_row gt_center" headers="stat_3">17 (7.1%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;$25,000-$49,999</td>
<td class="gt_row gt_center" headers="stat_0">186 (11%)</td>
<td class="gt_row gt_center" headers="stat_1">46 (14%)</td>
<td class="gt_row gt_center" headers="stat_2">105 (9.6%)</td>
<td class="gt_row gt_center" headers="stat_3">35 (15%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;$50,000-$74,999</td>
<td class="gt_row gt_center" headers="stat_0">232 (14%)</td>
<td class="gt_row gt_center" headers="stat_1">37 (12%)</td>
<td class="gt_row gt_center" headers="stat_2">150 (14%)</td>
<td class="gt_row gt_center" headers="stat_3">45 (19%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;$75,000-$99,999</td>
<td class="gt_row gt_center" headers="stat_0">202 (12%)</td>
<td class="gt_row gt_center" headers="stat_1">49 (15%)</td>
<td class="gt_row gt_center" headers="stat_2">130 (12%)</td>
<td class="gt_row gt_center" headers="stat_3">23 (9.5%)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;$100,000-$199,999</td>
<td class="gt_row gt_center" headers="stat_0">592 (36%)</td>
<td class="gt_row gt_center" headers="stat_1">94 (30%)</td>
<td class="gt_row gt_center" headers="stat_2">432 (39%)</td>
<td class="gt_row gt_center" headers="stat_3">66 (27%)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="label">&nbsp;&nbsp;&nbsp;&nbsp;$200,000 or more</td>
<td class="gt_row gt_center" headers="stat_0">391 (24%)</td>
<td class="gt_row gt_center" headers="stat_1">73 (23%)</td>
<td class="gt_row gt_center" headers="stat_2">263 (24%)</td>
<td class="gt_row gt_center" headers="stat_3">55 (23%)</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="5" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;"><sup>1</sup></span> n (%); Mean ± SD</td>
</tr>
</tfoot>

</table>

</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Reflection">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reflection
</div>
</div>
<div class="callout-body-container callout-body">
<p>Are there noticeable differences between respondent groups?</p>
</div>
</div>
</section>
<section id="multinomial-model-estimation" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="multinomial-model-estimation"><span class="header-section-number">6.6</span> Multinomial model estimation</h2>
<p>We will need a category of reference for outcome variable in multinomial models. By default in <code>R</code>, the reference is the first level/category of the outcome variable. However, we will choose ‘Drive’ for our case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>persons_main <span class="ot">&lt;-</span> persons_main <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mode_main =</span> <span class="fu">fct_relevel</span>(mode_main,  <span class="st">'Drive'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can fit the multinomial model using a similar syntax to what we’ve done before. The main mode (the dependent variable) is explained by whether individuals have free parking at work, as well as other control variables related to trips and socio-demographic characteristics. Important note: the <code>multinom()</code> function is not part of base R, but it’s available in from the <code>nnet::</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate Multinomial model</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>multinomial_model1 <span class="ot">&lt;-</span> <span class="fu">multinom</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> mode_main <span class="sc">~</span> free_parking <span class="sc">+</span> avg_distance <span class="sc">+</span> gender <span class="sc">+</span> higher_education <span class="sc">+</span> children, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> persons_main</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  27 (16 variable)
initial  value 1820.400562 
iter  10 value 1151.075327
iter  20 value 1131.837168
final  value 1130.330363 
converged</code></pre>
</div>
</div>
<p>The standard scale of the model output is the log of the odds (similar to logistic regression). We have already discussed some aspects of interpreting results on this scale, so we will avoid repetition and move directly to interpreting the coefficients on the odds ratio scale.</p>
<section id="exponentied-coefficients-odds-ratio" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1" class="anchored" data-anchor-id="exponentied-coefficients-odds-ratio"><span class="header-section-number">6.6.1</span> Exponentied coefficients: Odds ratio</h3>
<p>As we know, the log-odds scale is not very intuitive. Similar to what we did with logistic regression, we can exponentiate the coefficients to obtain the odds ratios, which allows us to interpret the coefficients in terms of percentage changes, holding other factors constant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>multinomial_model1 <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_glance_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="haoxypfbqz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#haoxypfbqz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#haoxypfbqz thead, #haoxypfbqz tbody, #haoxypfbqz tfoot, #haoxypfbqz tr, #haoxypfbqz td, #haoxypfbqz th {
  border-style: none;
}

#haoxypfbqz p {
  margin: 0;
  padding: 0;
}

#haoxypfbqz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#haoxypfbqz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#haoxypfbqz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#haoxypfbqz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#haoxypfbqz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#haoxypfbqz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#haoxypfbqz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#haoxypfbqz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#haoxypfbqz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#haoxypfbqz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#haoxypfbqz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#haoxypfbqz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#haoxypfbqz .gt_spanner_row {
  border-bottom-style: hidden;
}

#haoxypfbqz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#haoxypfbqz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#haoxypfbqz .gt_from_md > :first-child {
  margin-top: 0;
}

#haoxypfbqz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#haoxypfbqz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#haoxypfbqz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#haoxypfbqz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#haoxypfbqz .gt_row_group_first td {
  border-top-width: 2px;
}

#haoxypfbqz .gt_row_group_first th {
  border-top-width: 2px;
}

#haoxypfbqz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#haoxypfbqz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#haoxypfbqz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#haoxypfbqz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#haoxypfbqz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#haoxypfbqz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#haoxypfbqz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#haoxypfbqz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#haoxypfbqz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#haoxypfbqz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#haoxypfbqz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#haoxypfbqz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#haoxypfbqz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#haoxypfbqz .gt_left {
  text-align: left;
}

#haoxypfbqz .gt_center {
  text-align: center;
}

#haoxypfbqz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#haoxypfbqz .gt_font_normal {
  font-weight: normal;
}

#haoxypfbqz .gt_font_bold {
  font-weight: bold;
}

#haoxypfbqz .gt_font_italic {
  font-style: italic;
}

#haoxypfbqz .gt_super {
  font-size: 65%;
}

#haoxypfbqz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#haoxypfbqz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#haoxypfbqz .gt_indent_1 {
  text-indent: 5px;
}

#haoxypfbqz .gt_indent_2 {
  text-indent: 10px;
}

#haoxypfbqz .gt_indent_3 {
  text-indent: 15px;
}

#haoxypfbqz .gt_indent_4 {
  text-indent: 20px;
}

#haoxypfbqz .gt_indent_5 {
  text-indent: 25px;
}

#haoxypfbqz .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#haoxypfbqz div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="gt_col_headings header">
<th id="label" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"><strong>Characteristic</strong></th>
<th id="estimate" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>OR</strong></th>
<th id="conf.low" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>95% CI</strong></th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col"><strong>p-value</strong></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="4" id="Active" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">Active</td>
</tr>
<tr class="gt_row_group_first even">
<td class="gt_row gt_left" headers="Active  label">free_parking</td>
<td class="gt_row gt_center" headers="Active  estimate"><br>
</td>
<td class="gt_row gt_center" headers="Active  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="Active  p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;No</td>
<td class="gt_row gt_center" headers="Active  estimate">—</td>
<td class="gt_row gt_center" headers="Active  conf.low">—</td>
<td class="gt_row gt_center" headers="Active  p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;Yes</td>
<td class="gt_row gt_center" headers="Active  estimate">0.33</td>
<td class="gt_row gt_center" headers="Active  conf.low">0.23, 0.47</td>
<td class="gt_row gt_center" headers="Active  p.value">&lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Active  label">avg_distance</td>
<td class="gt_row gt_center" headers="Active  estimate">0.65</td>
<td class="gt_row gt_center" headers="Active  conf.low">0.60, 0.69</td>
<td class="gt_row gt_center" headers="Active  p.value">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Active  label">gender</td>
<td class="gt_row gt_center" headers="Active  estimate"><br>
</td>
<td class="gt_row gt_center" headers="Active  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="Active  p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;Boy/Man (cisgender or transgender)</td>
<td class="gt_row gt_center" headers="Active  estimate">—</td>
<td class="gt_row gt_center" headers="Active  conf.low">—</td>
<td class="gt_row gt_center" headers="Active  p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;Girl/Woman (cisgender or transgender)</td>
<td class="gt_row gt_center" headers="Active  estimate">0.49</td>
<td class="gt_row gt_center" headers="Active  conf.low">0.36, 0.67</td>
<td class="gt_row gt_center" headers="Active  p.value">&lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;Non-binary/Something else fits better</td>
<td class="gt_row gt_center" headers="Active  estimate">1.14</td>
<td class="gt_row gt_center" headers="Active  conf.low">0.47, 2.80</td>
<td class="gt_row gt_center" headers="Active  p.value">0.8</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;Prefer not to answer</td>
<td class="gt_row gt_center" headers="Active  estimate">0.78</td>
<td class="gt_row gt_center" headers="Active  conf.low">0.37, 1.64</td>
<td class="gt_row gt_center" headers="Active  p.value">0.5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Active  label">higher_education</td>
<td class="gt_row gt_center" headers="Active  estimate"><br>
</td>
<td class="gt_row gt_center" headers="Active  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="Active  p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;No</td>
<td class="gt_row gt_center" headers="Active  estimate">—</td>
<td class="gt_row gt_center" headers="Active  conf.low">—</td>
<td class="gt_row gt_center" headers="Active  p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;Yes</td>
<td class="gt_row gt_center" headers="Active  estimate">2.00</td>
<td class="gt_row gt_center" headers="Active  conf.low">1.33, 2.99</td>
<td class="gt_row gt_center" headers="Active  p.value">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Active  label">children</td>
<td class="gt_row gt_center" headers="Active  estimate"><br>
</td>
<td class="gt_row gt_center" headers="Active  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="Active  p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;No</td>
<td class="gt_row gt_center" headers="Active  estimate">—</td>
<td class="gt_row gt_center" headers="Active  conf.low">—</td>
<td class="gt_row gt_center" headers="Active  p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Active  label">&nbsp;&nbsp;&nbsp;&nbsp;Yes</td>
<td class="gt_row gt_center" headers="Active  estimate">0.39</td>
<td class="gt_row gt_center" headers="Active  conf.low">0.25, 0.59</td>
<td class="gt_row gt_center" headers="Active  p.value">&lt;0.001</td>
</tr>
<tr class="gt_group_heading_row odd">
<td colspan="4" id="Transit" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">Transit</td>
</tr>
<tr class="gt_row_group_first even">
<td class="gt_row gt_left" headers="Transit  label">free_parking</td>
<td class="gt_row gt_center" headers="Transit  estimate"><br>
</td>
<td class="gt_row gt_center" headers="Transit  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="Transit  p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;No</td>
<td class="gt_row gt_center" headers="Transit  estimate">—</td>
<td class="gt_row gt_center" headers="Transit  conf.low">—</td>
<td class="gt_row gt_center" headers="Transit  p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;Yes</td>
<td class="gt_row gt_center" headers="Transit  estimate">0.22</td>
<td class="gt_row gt_center" headers="Transit  conf.low">0.15, 0.32</td>
<td class="gt_row gt_center" headers="Transit  p.value">&lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Transit  label">avg_distance</td>
<td class="gt_row gt_center" headers="Transit  estimate">0.95</td>
<td class="gt_row gt_center" headers="Transit  conf.low">0.93, 0.97</td>
<td class="gt_row gt_center" headers="Transit  p.value">&lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Transit  label">gender</td>
<td class="gt_row gt_center" headers="Transit  estimate"><br>
</td>
<td class="gt_row gt_center" headers="Transit  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="Transit  p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;Boy/Man (cisgender or transgender)</td>
<td class="gt_row gt_center" headers="Transit  estimate">—</td>
<td class="gt_row gt_center" headers="Transit  conf.low">—</td>
<td class="gt_row gt_center" headers="Transit  p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;Girl/Woman (cisgender or transgender)</td>
<td class="gt_row gt_center" headers="Transit  estimate">0.67</td>
<td class="gt_row gt_center" headers="Transit  conf.low">0.49, 0.91</td>
<td class="gt_row gt_center" headers="Transit  p.value">0.010</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;Non-binary/Something else fits better</td>
<td class="gt_row gt_center" headers="Transit  estimate">1.57</td>
<td class="gt_row gt_center" headers="Transit  conf.low">0.69, 3.61</td>
<td class="gt_row gt_center" headers="Transit  p.value">0.3</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;Prefer not to answer</td>
<td class="gt_row gt_center" headers="Transit  estimate">0.79</td>
<td class="gt_row gt_center" headers="Transit  conf.low">0.39, 1.60</td>
<td class="gt_row gt_center" headers="Transit  p.value">0.5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Transit  label">higher_education</td>
<td class="gt_row gt_center" headers="Transit  estimate"><br>
</td>
<td class="gt_row gt_center" headers="Transit  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="Transit  p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;No</td>
<td class="gt_row gt_center" headers="Transit  estimate">—</td>
<td class="gt_row gt_center" headers="Transit  conf.low">—</td>
<td class="gt_row gt_center" headers="Transit  p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;Yes</td>
<td class="gt_row gt_center" headers="Transit  estimate">1.27</td>
<td class="gt_row gt_center" headers="Transit  conf.low">0.89, 1.82</td>
<td class="gt_row gt_center" headers="Transit  p.value">0.2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Transit  label">children</td>
<td class="gt_row gt_center" headers="Transit  estimate"><br>
</td>
<td class="gt_row gt_center" headers="Transit  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="Transit  p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;No</td>
<td class="gt_row gt_center" headers="Transit  estimate">—</td>
<td class="gt_row gt_center" headers="Transit  conf.low">—</td>
<td class="gt_row gt_center" headers="Transit  p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Transit  label">&nbsp;&nbsp;&nbsp;&nbsp;Yes</td>
<td class="gt_row gt_center" headers="Transit  estimate">0.38</td>
<td class="gt_row gt_center" headers="Transit  conf.low">0.25, 0.57</td>
<td class="gt_row gt_center" headers="Transit  p.value">&lt;0.001</td>
</tr>
<tr class="gt_group_heading_row odd">
<td colspan="4" id="NA" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">NA</td>
</tr>
<tr class="gt_row_group_first even">
<td class="gt_row gt_left" headers="NA  label" style="border-top-width: 2px; border-top-style: solid; border-top-color: #D3D3D3">edf</td>
<td class="gt_row gt_center" headers="NA  estimate" style="border-top-width: 2px; border-top-style: solid; border-top-color: #D3D3D3">16.0</td>
<td class="gt_row gt_center" headers="NA  conf.low" style="border-top-width: 2px; border-top-style: solid; border-top-color: #D3D3D3"><br>
</td>
<td class="gt_row gt_center" headers="NA  p.value" style="border-top-width: 2px; border-top-style: solid; border-top-color: #D3D3D3"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="NA  label">Deviance</td>
<td class="gt_row gt_center" headers="NA  estimate">2,261</td>
<td class="gt_row gt_center" headers="NA  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="NA  p.value"><br>
</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="NA  label">AIC</td>
<td class="gt_row gt_center" headers="NA  estimate">2,293</td>
<td class="gt_row gt_center" headers="NA  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="NA  p.value"><br>
</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="NA  label">No. Obs.</td>
<td class="gt_row gt_center" headers="NA  estimate">1,657</td>
<td class="gt_row gt_center" headers="NA  conf.low"><br>
</td>
<td class="gt_row gt_center" headers="NA  p.value"><br>
</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="4" class="gt_sourcenote">Abbreviations: CI = Confidence Interval, OR = Odds Ratio</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>Let’s give it a go to the key independent variable:</p>
<blockquote class="blockquote">
<p>Compared to individuals without free parking at work, the odds of using active travel are 66% lower than driving for those with free parking at their workplace. Similarly, the odds of using transit are about 80% lower than driving for people with free parking at work relative to those without it.</p>
</blockquote>
<p>More generally, we observe that the likelihood of both engaging in active travel and using transit is lower than driving for individuals with free parking at work compared to those without it. Additionally, the effect is more pronounced for transit than for active travel.</p>
<p>As you can see, we can use the following formula to express the changes in percent terms <code>(1 - coefficient) * 100</code>. However, we can also use the direct coefficient and talk about X times changes. This is helpful when we have large coefficients. For example:</p>
<blockquote class="blockquote">
<p>The odds of engaging in active travel, compared to driving, are twice as high for individuals with a higher education degree compared to those without one.</p>
</blockquote>
<p>For continuous variables the interpretation is as follows:</p>
<blockquote class="blockquote">
<p>For every additional average mile to work, the odds of engaging in active travel are 35% lower than driving. Likewise, the odds of riding transit are 5% lower than driving for every additional mile to work.</p>
</blockquote>
<div class="callout callout-style-default callout-tip callout-titled" title="Reflection">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Reflection
</div>
</div>
<div class="callout-body-container callout-body">
<p>Generally speaking, the odds of both active travel and transit use are less lower relative to driving and decrease as the distance to work increases. However, this effect is more pronounced for active travel. Does this difference align with your prior expectations?</p>
<p>Can you provide the interpretation for rest of the coefficients?</p>
</div>
</div>
</section>
</section>
<section id="model-assessment" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="model-assessment"><span class="header-section-number">6.7</span> Model assessment</h2>
<section id="goodness-of-fit" class="level3" data-number="6.7.1">
<h3 data-number="6.7.1" class="anchored" data-anchor-id="goodness-of-fit"><span class="header-section-number">6.7.1</span> Goodness-of-fit</h3>
<p>As with logistic regression, we can use the Akaike information criterion (AIC). Lower AIC values indicate a better-fitting model, i.e., a model that haves a good balance between goodness of fit and complexity.</p>
<p>We can compute a pseudo-r-squared value and other measures for mutlinomial models, too:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Measures of fit</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_performance</span>(multinomial_model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Can't calculate log-loss.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC      |     AICc |      BIC |    R2 | R2 (adj.) |  RMSE | Sigma
------------------------------------------------------------------
2292.661 | 2292.992 | 2379.265 | 0.216 |     0.215 | 0.360 | 1.174</code></pre>
</div>
</div>
<p>From the table the column ‘R2 (adj.)’ corresponds to McFadden’s pseudo R-squared values. This value ranges from 0 to 1. Higher values indicate a better-fitting model.</p>
<p>Additionally, we can look at the predictions. For instance, the model predictions look as following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model predictions</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>multinomial_model1<span class="sc">$</span>fitted.values[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Drive    Active   Transit
1 0.6841346 0.2008660 0.1149995
2 0.2465397 0.5798820 0.1735783
3 0.4354326 0.2992195 0.2653478
4 0.2932488 0.5075853 0.1991659
5 0.6122968 0.2793167 0.1083864
6 0.5541075 0.3076808 0.1382118</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(multinomial_model1)[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Drive  Active Drive  Active Drive  Drive 
Levels: Drive Active Transit</code></pre>
</div>
</div>
<p>We can check these predictions against observed data using a confusion matrix, and related measures:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correctly predicted classes</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>predicted_classes <span class="ot">&lt;-</span> <span class="fu">predict</span>(multinomial_model1)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(predicted_classes, persons_main<span class="sc">$</span>mode_main)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction Drive Active Transit
   Drive    1008    125     194
   Active     90    193      47
   Transit     0      0       0

Overall Statistics
                                          
               Accuracy : 0.7248          
                 95% CI : (0.7026, 0.7462)
    No Information Rate : 0.6626          
    P-Value [Acc &gt; NIR] : 3.081e-08       
                                          
                  Kappa : 0.3616          
                                          
 Mcnemar's Test P-Value : &lt; 2.2e-16       

Statistics by Class:

                     Class: Drive Class: Active Class: Transit
Sensitivity                0.9180        0.6069         0.0000
Specificity                0.4293        0.8977         1.0000
Pos Pred Value             0.7596        0.5848            NaN
Neg Pred Value             0.7273        0.9058         0.8546
Prevalence                 0.6626        0.1919         0.1454
Detection Rate             0.6083        0.1165         0.0000
Detection Prevalence       0.8008        0.1992         0.0000
Balanced Accuracy          0.6737        0.7523         0.5000</code></pre>
</div>
</div>
<p>The diagonal values in the Confusion Matrix indicate the number of correct predictions. The sensitivity in Statistics by Class indicates the percentage of correct predictions. For further information consult the function documentation typing <code>?confusionMatrix</code>.</p>
</section>
</section>
<section id="individual-activities" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="individual-activities"><span class="header-section-number">6.8</span> Individual activities</h2>
<p>Run a similar analysis, but this time focus on sustainable modes. Specifically, disaggregate active travel into ‘Walk’ and ‘Bike’, and include ‘Transit’. Exclude all other modes from the model. Examine the relationship of employer subsidies for public transport in the model, such as free passes or fares. This information can be found in the ‘persons’ table. Interpret the result of the model.</p>
</section>
<section id="bonus-multinomial-model-assumption-checks" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="bonus-multinomial-model-assumption-checks"><span class="header-section-number">6.9</span> Bonus: Multinomial model assumption checks</h2>
<p>Generally, there are two main assumptions for the multinomial model (Harris, 2020):</p>
<ol type="1">
<li>Independence of errors, and</li>
<li>independence of irrelevant alternatives (IIA).</li>
</ol>
<p>Independence of errors relates to the structure of the data or the way it has been collected. In this case, individuals might have dependencies at the household level.</p>
<p>The IIA assumption states that the odds of choosing between any two alternatives are unaffected by the presence of other alternatives. For example, the odds of choosing active travel over driving are assumed to be unaffected by the presence of transit. In other words, if transit were removed from the model, the relative odds between drive and active would remain the same.</p>
<p>The Hausman-McFadden test is helpful to check if the IIA assumption holds. For our example, we can run the check as demonstrated below. However, we require another package, <code>mlogit</code>, and the structure of the data needs to be transformed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlogit)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure all categorical variables are factors</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>persons_main <span class="ot">&lt;-</span> persons_main <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(is.character, as.factor)) </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert data to mlogit format</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>mlogit_data <span class="ot">&lt;-</span> <span class="fu">mlogit.data</span>(</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  persons_main, </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">choice =</span> <span class="st">"mode_main"</span>, </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> <span class="st">"wide"</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Refit the model using mlogit()</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>mlogit_model <span class="ot">&lt;-</span> <span class="fu">mlogit</span>(</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> mode_main <span class="sc">~</span>  <span class="dv">0</span> <span class="sc">|</span> avg_distance <span class="sc">+</span> gender <span class="sc">+</span> higher_education <span class="sc">+</span> children, </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mlogit_data</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Refit the model using mlogit() with an alternative specification</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>mlogit_model_alt <span class="ot">&lt;-</span> <span class="fu">mlogit</span>(</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> mode_main <span class="sc">~</span>  <span class="dv">0</span> <span class="sc">|</span> avg_distance <span class="sc">+</span> gender <span class="sc">+</span> higher_education <span class="sc">+</span> children, </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mlogit_data,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">alt.subset =</span> <span class="fu">c</span>(<span class="st">'Drive'</span>, <span class="st">'Active'</span>)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Hausman-McFadden test</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="fu">hmftest</span>(<span class="at">x =</span> mlogit_model, <span class="at">z =</span> mlogit_model_alt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Hausman-McFadden test

data:  mlogit_data
chisq = 98.235, df = 7, p-value &lt; 2.2e-16
alternative hypothesis: IIA is rejected</code></pre>
</div>
</div>
<p>The null hypothesis assumes that IIA holds. Since it’s rejected in our results, this suggests that the IIA assumption does NOT hold in this model. The implication is that the multinomial logit model might not be appropriate because the choice probabilities are affected by irrelevant alternatives. In such a case, a nested logit model can be an alternative. However, this is out of the scope of this course. More information is available at <a href="https://github.com/friendly/nestedLogit" class="uri">https://github.com/friendly/nestedLogit</a>.</p>
</section>
<section id="references-and-further-reading" class="level2" data-number="6.10">
<h2 data-number="6.10" class="anchored" data-anchor-id="references-and-further-reading"><span class="header-section-number">6.10</span> References and further reading</h2>
<p>Ch. 11 - Harrys J.K. (2020), Statistics With R: Solving Problems Using Real-World Data. Sage Publishing.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./session-5.html" class="pagination-link" aria-label="Session 5: Logistic regression Part 2">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Session 5: Logistic regression Part 2</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./session-7.html" class="pagination-link" aria-label="Session 7: Poisson regression">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Session 7: Poisson regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>